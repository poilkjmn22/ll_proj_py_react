import{w as b}from"./with-props-Bz5eeop3.js";import{v as E,a as i,q as N,n as e,t as v}from"./chunk-XJI4KG32-C1znyQtU.js";import{u as T}from"./request-Dv1uV-Bk.js";const L=b(function(){const{topicId:s}=E(),[o,x]=i.useState(null),[c,p]=i.useState([]),[w,h]=i.useState(!0),[u,l]=i.useState(null),m=N(),d=T();i.useEffect(()=>{s&&(async()=>{try{h(!0);const n=await d(`/api/topics/${s}/`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`获取主题详情失败: ${n.status}`);const a=await n.json();x(a);const r=await d(`/api/topics/${s}/entries/`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`获取条目列表失败: ${r.status}`);const g=await r.json();p(g),l(null)}catch(n){console.error("获取数据失败:",n),l("获取主题和条目数据时出错，请稍后再试")}finally{h(!1)}})()},[s]);const f=async t=>{if(window.confirm("您确定要删除这个条目吗？"))try{const a=await d(`/api/entries/${t}/`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`删除失败: ${a.status}`);p(c.filter(r=>r.id!==t))}catch(a){console.error("删除条目失败:",a),l("删除条目时出错，请稍后再试")}},j=t=>{m(`/newEntry/${s}/${t}`)};if(w)return e.jsx("div",{children:"加载中..."});if(u)return e.jsx("div",{className:"error",children:u});if(!o)return e.jsx("div",{children:"未找到该主题"});const y=()=>{m(`/newEntry/${s}`)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:o.text}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["创建时间: ",new Date(o.date_added).toLocaleString()]}),e.jsxs("div",{className:"entries bg-white shadow-md rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"条目列表"}),e.jsx("button",{onClick:y,className:"mb-4 bg-blue-500 text-white p-2 rounded",children:"添加新条目"})]}),c.length>0?e.jsx("ul",{className:"space-y-2",children:c.map(t=>e.jsxs("li",{className:"entry p-2 border-b border-gray-200 relative group",children:[e.jsx("div",{className:"entry-text text-lg whitespace-pre-wrap",children:t.text}),e.jsx("div",{className:"entry-date text-gray-500",children:new Date(t.date_added).toLocaleString()}),e.jsx("button",{className:"absolute right-16 bg-yellow-500 text-white p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>j(t.id),children:"编辑"}),e.jsx("button",{className:"absolute right-0 bg-red-500 text-white p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>f(t.id),children:"删除"})]},t.id))}):e.jsx("p",{className:"text-gray-500",children:"该主题下还没有条目。"})]}),e.jsx("div",{className:"actions mt-4",children:e.jsx(v,{to:"/topics",className:"text-blue-500 hover:underline",children:"返回主题列表"})})]})});export{L as default};
