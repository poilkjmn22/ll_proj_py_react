import{w as v}from"./with-props-Bz5eeop3.js";import{a as r,v as w,q as T,n as e,t as E}from"./chunk-XJI4KG32-C1znyQtU.js";import{u as N}from"./request-Dv1uV-Bk.js";const I=v(function(){const[y,j]=r.useState([]),[a,m]=r.useState(void 0),[l,u]=r.useState(""),[x,d]=r.useState(null),{topicId:p,entryId:o}=w(),h=N(),b=T(),c=r.useMemo(()=>o?"更新条目":"新建条目",[o]);r.useEffect(()=>{const t=async()=>{try{const s=await h("/api/topics/",{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`API请求失败: ${s.status}`);const n=await s.json();j(n)}catch(s){console.error("获取主题失败:",s),d("获取主题列表时出错，请稍后再试")}};m(p),t(),o&&(async()=>{try{const n=await(await h(`/api/entries/${o}/`,{method:"GET",headers:{"Content-Type":"application/json"}})).json();console.log(n,"entry data"),u(n.text)}catch(s){console.error("获取主题失败:",s),d("获取主题列表时出错，请稍后再试")}})()},[p]);const f=async t=>{if(t.preventDefault(),a&&l)try{const i=o?"PUT":"POST",s=o?`/api/entries/${o}/`:"/api/entries/",n=await h(s,{method:i,headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:a,text:l,...o?{id:o}:void 0})});if(!n.ok)throw new Error(`提交失败: ${n.status}`);b(`/topics/${a}`)}catch(i){console.error(`${c}失败:`,i),d(`${c}时出错，请稍后再试`)}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:c}),x&&e.jsx("p",{className:"text-red-500",children:x}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"topic",className:"block mb-2",children:"选择主题:"}),e.jsxs("select",{id:"topic",value:a||"",onChange:t=>m(t.target.value),className:"border p-2 mb-4",children:[e.jsx("option",{value:"",children:"请选择主题"}),y.map(t=>e.jsx("option",{value:t.id,children:t.text},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"entryText",className:"block mb-2",children:"条目内容:"}),e.jsx("textarea",{id:"entryText",value:l,rows:12,onChange:t=>u(t.target.value),className:"border p-2 mb-4 w-full"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-10",children:[e.jsx(E,{to:`/topics/${p}`,className:"text-blue-500 hover:underline",children:"取消"}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white p-2 rounded",children:c})]})]})]})});export{I as default};
